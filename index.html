<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau Embedded Visualization</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            background-color: #343a40 !important;
        }
        .navbar-brand {
            color: #ffffff !important;
        }
        .nav-link {
            color: #ffffff !important;
        }
        .footer {
            background-color: #343a40;
            color: #ffffff;
        }
        .navbar img {
            height: 40px;
            margin-right: 10px;
        }
    </style>
<script>
    function createToken(userName,kid,secret,iss,scp){
  var header = {
    "alg": "HS256",
    "typ": "JWT",
    "iss": iss, //CONNECTED APP ID
    "kid": kid, //CONNECTED APP SECRET ID
  };
  var stringifiedHeader = CryptoJS.enc.Utf8.parse(JSON.stringify(header));
  var encodedHeader = base64url(stringifiedHeader);
  var claimSet = {
    "sub": userName, // THE USER NAME, like aalteirac@tableau.com 
    "aud":"tableau",
    "nbf":Math.round(new Date().getTime()/1000)-100,
    "jti":new Date().getTime().toString(),
    "iss": iss,
    "scp": scp.split(","),
    "exp": Math.round(new Date().getTime()/1000)+100
  };
  var stringifiedData = CryptoJS.enc.Utf8.parse(JSON.stringify(claimSet));
  var encodedData = base64url(stringifiedData);
  var token = encodedHeader + "." + encodedData;
  var signature = CryptoJS.HmacSHA256(token, secret); //CONNECTED APP SECRET
  signature = base64url(signature);
  var signedToken = token + "." + signature;
  return signedToken;
}

//Base64URL is a modification of the main (https://base64.guru/standards/main) Base64 standard. 
function base64url(source) {
  encodedSource = CryptoJS.enc.Base64.stringify(source);
  encodedSource = encodedSource.replace(/=+$/, '');
  encodedSource = encodedSource.replace(/\+/g, '-');
  encodedSource = encodedSource.replace(/\//g, '_');
  return encodedSource;
}
function go(){
    var userid="tc24.hot.wcag@gmail.com"
    // Client ID
    var iss="f3720490-9472-454d-aef2-303a24c22909"
    // Secret ID
    var kid="effdeef5-7c27-44a2-bb62-ddfc75760c9d"
    // Secret Key
    var secret="8nNt+gxIP7ZGX/TNbX1QnxCx9vz8MumglOoicsWwVZE="
    var wurl='tableau url'
    var scope="['tableau:views:embed']"
    var scopes = Array.from(scope).map(({ value }) => value);
    console.log(scopes)
    var token= createToken(userid,kid,secret,iss,scope);
    // document.getElementById("jwt").value=token;
    let tp=`
    <tableau-viz id="tableauViz" src="${wurl}" 
      token="${token}"
      height="700"
      width="1200"
      toolbar="Bottom" hide-tabs>
    </tableau-viz>`
    document.getElementById('dash').innerHTML =tp;
  }
    
</script>
</head>
<body onload="go()">
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <!-- Image to the left of the navbar -->
            <a class="navbar-brand" href="#">
                <img src="https://sandiegozoowildlifealliance.org/themes/custom/park_stable/images/sdzwa-green.svg" alt="SDZWA Logo">
                Your Company
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Services</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content Section -->
    <div class="container mt-5">
        <h1 class="text-center mb-4">Tableau Embedded Visualization</h1>
        <!-- Tableau Embedded Visualization -->
       
            <!-- Replace the src attribute with your Tableau embed URL -->
            <div id='dash' >
            </div>

    </div>

    <!-- Footer -->
    <footer class="footer bg-dark text-light py-4">
        <div class="container text-center">
            <span>&copy; 2024 Tableau Conference. All rights reserved.</span>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <script type="module" src="https://prod-useast-b.online.tableau.com/javascripts/api/tableau.embedding.3.latest.min.js"></script>
</body>
</html>
